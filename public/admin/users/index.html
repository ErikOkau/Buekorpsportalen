<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brukere</title>
    <link rel="stylesheet" href="../../../css/main.css">
    <link rel="stylesheet" href="../../../css/users.css">
    <link rel="stylesheet" href="../../../css/nav.css">
</head>

<body>
    <nav>
        <ul class="animated-nav">
            <li>
                <a href="../index.html" class="nav-link">Admin Dashboard</a>
            </li>
            <li>
                <a href="../users/" class="nav-link">Brukere</a>
            </li>
            <li>
                <a href="../companies/" class="nav-link">Kompanier</a>
            </li>
            <li>
                <a href="/logout" id="logoutBtn" class="nav-link">Sign out</a>
            </li>
        </ul>
    </nav>

    <div class="tables">
         <h2>Admins</h2>
        <div id="adminTable"></div>

        <h2>Ledere</h2>
        <div id="leaderTable"></div>

        <h2>Foreldre</h2>
        <div id="parentTable"></div>

        <h2>Medlemmer</h2>
        <div id="memberTable"></div>
    </div>
   
    <script>
    ['admin', 'leader', 'member'].forEach(role => {
    fetch(`/showDB?role=${role}`)
        .then(response => response.json())
        .then(users => {
        const table = document.createElement('table');
        table.innerHTML = `
            <tr>
            <th class="id">ID</th>
            <th class="name">Navn</th>
            <th class="surname">Etternavn</th>
            <th class="email">Email</th>
            <th class="parent">Forelder</th>
            <th class="actions">Handlinger</th>
            </tr>
            ${users.map(user => `
            <tr>
                <td class="id">${user.id}</td>
                <td class="name">${user.name}</td>
                <td class="surname">${user.surname}</td>
                <td class="email">${user.email}</td>
                <td class="actions">
                <button class="edit_btn" onclick="location.href='/editUser?id=${user.id}'">Edit</button>
                <button class="delete_btn" onclick="deleteUser(${user.id})">Delete</button>
                </td>
            </tr>
            `).join('')}
        `;
        document.getElementById(`${role}Table`).appendChild(table);
        });
    });

    ['parent'].forEach(role => {
    fetch(`/showDB?role=${role}`)
        .then(response => response.json())
        .then(users => {
        const table = document.createElement('table');
        table.innerHTML = `
            <tr>
            <th class="id">ID</th>
            <th class="name">navn</th>
            <th class="surname">Etternavn</th>
            <th class="email">Email</th>
            <th class="child">Barn</th>
            <th class="actions">Handlinger</th>
            </tr>
            ${users.map(user => `
            <tr>
                <td class="id">${user.id}</td>
                <td class="name">${user.name}</td>
                <td class="surname">${user.surname}</td>
                <td class="email">${user.email}</td>
                <td class="child">${user.child}</td>
                <td class="actions">
                <button class="edit_btn" onclick="location.href='/editUser?id=${user.id}'">Edit</button>
                <button class="delete_btn" onclick="deleteUser(${user.id})">Delete</button>
                </td>
            </tr>
            `).join('')}
        `;
        document.getElementById(`${role}Table`).appendChild(table);
        });
    });
    
    function deleteUser(id) {
        if (confirm('Are you sure you want to delete this user?')) {
        fetch(`/deleteUser?id=${id}`, { method: 'DELETE' })
            .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Error deleting user');
            }
            });
        }
    }
    </script>
</body>
</html>