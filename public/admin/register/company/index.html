<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company</title>
    <link rel="stylesheet" href="../../../css/register.css">
    <link rel="stylesheet" href="../../../css/nav.css">
    <link rel="stylesheet" href="../../../css/main.css">
</head>

<style>
    .image_test {
        height: 100px;
        width: 100px;
    }
</style>
<body> 
    <nav>
        <ul class="animated-nav">
            <li>
                <a href="../index.html" class="nav-link">Admin Dashboard</a>
            </li>
            <li>
                <a href="../../users/" class="nav-link">Brukere</a>
            </li>
            <li>
                <a href="../../companies/" class="nav-link">Kompanier</a>
            </li>
            <li>
                <a href="/logout" id="logoutBtn" class="nav-link">Sign out</a>
            </li>
        </ul>
    </nav>


    <div class="register-container">
        <h1>Create Company</h1>
        <form id="companyForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name" id="remove_bg">Company Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="description" id="remove_bg">Description:</label>
                <textarea id="description" name="description" required></textarea>
            </div>
            <div class="form-group">
                <label for="logo" id="remove_bg">Bilde:</label>
                <label for="logo"><img class="image_test" src="image.svg" id="display" alt="test"></label>
                <input type="file" id="logo" name="logo" accept="image/*">
            </div>
            <div class="form-group">
                <label for="address" id="remove_bg">Address:</label>
                <input type="text" id="address" name="address" required>
            </div>
            <div class="form-group">
                <label for="city" id="remove_bg">City:</label>
                <input type="text" id="city" name="city" required>
            </div>
 
            <input class="btn" type="submit" value="Add Company">
        </form>
    </div>
    
    <script>
        const form = document.getElementById('companyForm');
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const description = document.getElementById('description').value;
            const logo = document.getElementById('logo').files[0];
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries())

            let reader = new FileReader()
            reader.onload = function() {
                document.getElementById("display").src = reader.result
            }

            reader.readAsDataURL(data.logo)

            // Perform a fetch request to submit form data to the server
            try {
                const res = await fetch('/admin/company', {
                    method: 'POST',
                    body: formData
                });

                if (!res.ok) {
                    throw new Error('Failed to create company');
                }

                const result = await res.json();
                // Optionally, handle the result if needed

                // Redirect to another page or show a success message upon successful company creation
                alert('Company added successfully');
                // Redirect to a page, for example:
                window.location.href = '/admin/companies'; // Redirect to the companies listing page
            } catch (error) {
                console.error('Error creating company:', error);
                // Handle errors, show an alert, or take appropriate action
                alert('Failed to create company. Please try again.');
            }

            /* const res = await fetch('/admin/company', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: formData
            })

            const result = await res.json() */

        });
    </script>

    <script src="../../ts/main.ts" defer></script>
</body>
</html>